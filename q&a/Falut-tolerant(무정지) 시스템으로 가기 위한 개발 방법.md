## Falut-tolerant(무정지) 시스템으로 가기 위한 개발 방법



기본적으로 서버는 물리적/소프트웨어적으로 이중화 되어 있어야 하며(서버/디비), 모든 서버는 두대이상이라 생각한다.

### 1. 패치 (API교체)

#### 서버의 기존 로직을 변경하기 위해 서버의 재시작 / 새 데이터 로드 할 경우

- 두대의 그룹으로 하나는 이전 가동중인 서버그룹(s1) / 하나는 새로운 버전의 서버그룹(s2)

- s1의 하나의 서버를 s2의 서버로 교체

- 교체가 완료되면(정상작동한다면), 나머지 서버를 차례로 교체

- 모든 서버의 요청은 API단위로 이루어지며, 모든 요청 처리가 하위 호환이 되도록 버전별 api가 존재 (새 버전의 에러시 바로 교체 가능)



  

### 2. 서버 재시작 필요

#### 설정파일을 새롭게 로드해야 하는 경우

- 설정파일은 로컬에 존재하면 안되며 (로컬파일일 경우 모든 서버에 업로드 해야 하며, 재시작 필요), config서버를 통해 해당 파일을 요청하는 형식으로 한다.

- 통신의 형태는 protobuf 프로토콜 사용한 직렬화 ([https://developers.google.com/protocol-buffers/docs/pythontutorial](https://developers.google.com/protocol-buffers/docs/pythontutorial))

  

  

### 3. 스케일링

#### 서버 증설을 위한 서버 재시작

- 각 서버의 통신을 직접하지 않고, 프록시서버를 이용하여 모든 통신을 제어

- rabbitMQ를 통해 서버의 통신을 제어하면, 모든 서버는 rabiitMQ서버에만 붙여주면된다. (서버증설이 용이해짐)

  

  

### 4. 장애

- 단일장애점(하나의 장애로 인해 모든 서비스정지)를 막기 위해 최대한 서버의 분산화 및 복잡도 낮춤

- 헬스 체킹 및 장애 서버의 교체 자동화

  

  

[https://www.slideshare.net/taehyunkim73700/ss-114924418](https://www.slideshare.net/taehyunkim73700/ss-114924418)
