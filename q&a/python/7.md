
## 파이썬의 GC는 어떻게 작동하나요?


### garbage collection + reference counting(레퍼런스 카운팅)

  

참조횟수가 0이 된 객체를 메모리에서 해제하는 레퍼런스 카운팅 방식으로 해제 하며,

순환참조에 의해 참조횟수가 0이 되지 않는 객체들을 GC로 처리 한다.

  

gc가 동작하는 시점은 각각의 파이썬 시작시 기본값을 가지는 gc한계치를 정하게 된다.

700메가일 경우 700메가 이상의 레퍼런스카운팅이 0일 경우 gc로 메모리를 해제 하게 된다.

(혹은 프로그램이 끝날ㄷ떄)

혹은 프로그램 도중의 도중 랜덤하게 실행하여 프로그램의 동작에 영향이 가지 않게 한다.

  

순환참조 예제
```

>>> l = []

>>> l.append(l)

>>> del l
```
  

l의 참조횟수는 1이지만 접근 할수가 없는 순환참조가 된다. (일반변수는 순환참조가 일어나지 않으므로, list, dict, class , set 만 감시하면 됨)

GC의 경우 collect()함수를 통해 순환참조를 검사하는데

1. 모든 객체엔 두개의 포인터가 존재. (gc_next, gc_prev)

2. 해당 객체가 선언되었을 경우 gc_refs엔 2가 선언되고, 참조될때마다 카운트는 증가 / 소멸할때 마다 카운트는 감소

3. gc_next, gc_prev를 통해 각각의 객체가 참조하는 모든 객체들을 검사한다.

4. 하나의 객체에서 시작해서 next->next->next->… 를 했지만 다시 자기 자신으로 돌아온다면 순환참조가 된다.

5. 해당 모든 객체들의 gc_refs를 0으로 바꿔 해제하게 만든다.
